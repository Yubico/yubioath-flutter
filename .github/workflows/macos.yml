name: macOS

on: [push, pull_request]

jobs:
  build:

    runs-on: macos-latest

    steps:
    - uses: actions/checkout@v4

    - name: Read variables from repo
      run: cat .github/workflows/env >> $GITHUB_ENV

    - name: Check app versions
      run: |
        python3 set-version.py
        git diff --exit-code

    - name: Set up Python
      uses: actions/setup-python@v5
      with:
        python-version: ${{ env.PYVER }}

    - name: Set up CocoaPods
      uses: maxim-lobanov/setup-cocoapods@v1
      with:
        podfile-path: macos/Podfile.lock

    - name: Install dependencies
      run: |
        brew update
        brew install swig
        python -m pip install --upgrade pip
        pip install poetry

    - name: Build the Helper
      run: ./build-helper.sh

    - name: Upload artifact
      uses: actions/upload-artifact@v4
      with:
        name: helper-macos
        path: build/macos/
